#!/bin/sh
# postinst script for solv

set -e

case "$1" in
    configure)
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac


# Check if nodenv is already installed for solv user
sudo -u solv -H sh -c 'if [ ! -d "/home/solv/.nodenv" ]; then
    echo "Installing nodenv for solv user"
    git clone https://github.com/nodenv/nodenv.git /home/solv/.nodenv
    ln -vs /home/solv/.nodenv/bin/nodenv /usr/local/bin/nodenv
    cd /home/solv/.nodenv && src/configure && make -C src || true
    mkdir -p /home/solv/.nodenv/plugins
    echo "Installing nodenv plugins"
    git clone https://github.com/nodenv/node-build.git /home/solv/.nodenv/plugins/node-build
    git clone https://github.com/nodenv/nodenv-aliases.git /home/solv/.nodenv/plugins/nodenv-aliases
    nodenv install 18.17.1
    nodenv global 18.17.1
    if ! grep -q "nodenv init" /home/solv/.zshrc; then
        echo "$(nodenv init - zsh)" >> /home/solv/.zshrc
    fi
    exec zsh
fi
'

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
